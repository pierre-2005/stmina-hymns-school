{% extends "base.html" %}
{% block content %}
<div class="crumbs">
  <a href="/">Levels</a><span>›</span>
  <a href="/levels/{{ level.slug }}">{{ level.name }}</a><span>›</span>
  <a href="/levels/{{ level.slug }}/{{ year.slug }}">{{ year.name }}</a><span>›</span>
  <span>{{ hymn.title }}</span>
</div>

<div class="card">
  <div class="card-h">
    <h1 class="h1">{{ hymn.title }}</h1>
    <div class="muted">{{ hymn.note }}</div>
  </div>

  <div class="card-b">

    <div class="playerbar">
      <audio
        id="audio"
        class="audio"
        controls
        preload="metadata"
        src="{{ recordings[0].url if recordings and recordings[0].url else '' }}"
      ></audio>
    </div>

    <div class="controls">
      <div class="lang-row">
        {% for lang in languages %}
            <label class="lang-toggle" data-lang-code="{{ lang.code }}" data-default="{{ '1' if lang.default_on else '0' }}">
            <span class="lang-name">{{ lang.name }}</span>
            <input type="checkbox" class="lang-check">
            <span class="pill">ON</span>
          </label>
        {% endfor %}
      </div>

      <div class="font-row">
        <span class="muted">Font:</span>
        <button class="btn" type="button" id="fontPlus">+</button>
        <button class="btn" type="button" id="fontMinus">−</button>
      </div>
    </div>

    <div class="lyrics-wrap">
      <table class="lyrics" id="lyricsTable">
        <tbody>
          {% for seg in segments %}
            <tr class="seg" data-start-ms="{{ seg.start_ms }}">
              {% for lang in languages %}
                <td class="cell lang-{{ lang.code }}" data-lang="{{ lang.code }}"
                    dir="{{ 'rtl' if lang.is_rtl else 'ltr' }}">
                  {{ (seg.texts.get(lang.code,'') | e).replace('\n','<br>') | safe }}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>
{% endblock %}
